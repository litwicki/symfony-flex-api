{% extends 'TavroAppBundle:Layouts:admin.html.twig' %}
{% block title %}Users{% endblock %}
{% block admin -%}

  <div ng-controller="AdminController as adminCtrl">
    <section ng-init="loadUsers()">

      <div ng-if="usersLoading" class="text-primary" style="line-height: 180px;">
        <h1 class="text-center"><i class="fa fa-fw fa-refresh fa-spin fa-5x"></i><br />Users loading...</h1>
      </div>

      <div class="alert alert-warning" ng-show="!usersLoading && !users.length">
        <i class="fa fa-fw fa-warning"></i> There were no users to load.
      </div>

      <div id="users" ng-if="users.length && !usersLoading">

        <ul class="list-inline">
          <li><input ng-model="search.username" placeholder="filters users by username" class="input-sm form-control" type="search" style="width: 200px;" /></li>
          <li><input ng-model="search.email" placeholder="filter users by email" class="input-sm form-control" style="width: 200px;" type="search" /></li>
          <li>
            <label for="status">Status</label>
            <select class="form-control" id="status" name="status" ng-model="search.status">
              <option value="">Any</option>
              <option value="0">Disabled</option>
              <option value="1">Active</option>
              <option value="2">Pending Review</option>
            </select>
          </li>
          <li>
            <label for="roles">Filter by Role</label>
            <select class="form-control" id="roles" name="roles" ng-model="search.role">
              <option value="">All</option>
              <option value="ROLE_USER">User</option>
              <option value="ROLE_DEVELOPER">Developer</option>
              <option value="ROLE_MODERATOR">Moderator</option>
              <option value="ROLE_ADMIN">Administrator</option>
              <option value="ROLE_CSE">CSE</option>
            </select>
          </li>
        </ul>

        <hr />

        <table st-table="users" class="table table-striped table-hover">
          <thead>
            <tr>
              <th></th>
              <th></th>
              <th st-sort="username"><i class="fa fa-fw fa-user"></i> Username</th>
              <th st-sort="email"><i class="fa fa-fw fa-envelope"></i> Email</th>
              <th st-sort="create_date"><i class="fa fa-fw fa-calendar-o"></i> Join Date</th>
              <th st-sort="last_online_date"><i class="fa fa-fw fa-clock"></i> Last Online</th>
              <th>Role(s)</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
          <tr dir-paginate="user in users | filter:{email:search.email} | filter:{username:search.username} | filter:{roles:search.role} | filter:{status:search.status} | itemsPerPage: 25">
            <td><i class="fa fa-fw" ng-class="{'text-warning fa-spinner fa-spin': user.status == 2, 'text-success fa-check-circle':user.status == 1, 'text-danger fa-close': user.status == 0}"></i></td>
            <td><a href="/users/{[user.username]}"><img alt="{[user.username]}" ng-src="{[ user.avatar && '/media/cache/resolve/tiny_avatar/' + user.avatar.aws_key || '/bundles/tavrocore/img/avatars/default.gif' ]}" class="img-circle img-responsive user-avatar user-avatar-{[user.id]} img-thumbnail" /></a></td>
            <td>{[user.username]}</td>
            <td><a href="mailto:{[user.email]}">{[user.email]}</a></td>
            <td>{[user.create_date|date:'short']}</td>
            <td><span class="small text-muted" ng-if="user.last_online_date">{[user.last_online_date|timeago]}</span></td>
            <td><span class="label label-default small" ng-repeat="role in user.roles">{[role]}</span></td>
            <td>
              <ul class="list-inline">
                <li ng-if="user.status != 1"><a href="#" class="btn btn-default btn-xs" ng-click="activateUser(user)"><i class="fa fa-fw fa-check text-success"></i></a></li>
                <li ng-if="user.status != 2"><a href="#" class="btn btn-default btn-xs" ng-click="deactivateUser(user)"><i class="fa fa-fw fa-ban"></i></a></li>
                <li ng-if="user.status != 0"><a href="#" class="btn btn-default btn-xs" ng-click="deleteUser(user)"><i class="fa fa-fw fa-trash text-danger"></i></a></li>
              </ul>
            </td>
          </tr>
          </tbody>
        </table>

      </div>

      <div class="text-center">
        <dir-pagination-controls boundary-links="true" max-size="10"></dir-pagination-controls>
      </div>

    </section>
  </div>

{% endblock %}